<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Apple Trade ‚Äî Canje iPhone</title>

  <style>
    :root{
      --primary:#0071e3;
      --bg:#f5f5f7;
      --text:#1d1d1f;
      --muted:#6e6e73;
      --border:rgba(0,0,0,.08);

      --usd:#16a34a;

      --shadow: 0 10px 26px rgba(0,0,0,.06);
      --shadow-hover: 0 16px 42px rgba(0,0,0,.10);

      --wa:#25D366;
    }

    *{ box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; }
    body{ margin:0; background:var(--bg); color:var(--text); }

    header{
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
      padding:18px 20px;
      text-align:center;
      font-weight:650;
      font-size:1.15rem;
      position:sticky;
      top:0;
      z-index:50;
    }

    main{ padding:20px; max-width:1200px; margin:auto; }

    /* filtros */
    .filters{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-bottom:12px;
    }
    select{
      width:min(420px,100%);
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      outline:none;
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
      transition: box-shadow .2s ease, border-color .2s ease;
    }
    select:focus{
      border-color: rgba(0,113,227,.35);
      box-shadow: 0 0 0 4px rgba(0,113,227,.15);
    }

    /* toolbar: contador + orden */
    .toolbar{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      margin: 6px 0 16px;
    }
    .results-count{
      font-size:.92rem;
      color: var(--muted);
      font-weight:650;
    }

    .products{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
      gap:18px;
    }

    .product{
      background:#fff;
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .product:hover{
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
      border-color: rgba(0,0,0,.12);
    }

    .product h3{
      margin:0 0 6px;
      font-size:1.05rem;
      letter-spacing:-.2px;
      line-height:1.25rem;
    }

    /* condici√≥n como texto simple */
    .condition-text{
      margin:0 0 6px;
      font-size:.88rem;
      color: var(--muted);
      font-weight:650;
    }

    .details{
      margin:8px 0 10px;
      font-size:.92rem;
      color:#515154;
      line-height:1.25rem;
    }

    /* chips de color */
    .color-chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin:8px 0 6px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(245,245,247,.7);
      font-size:.82rem;
      color:#2b2b2f;
      font-weight:650;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      border:1px solid rgba(0,0,0,.15);
      box-shadow: 0 1px 2px rgba(0,0,0,.10) inset;
    }

    /* USD verde */
    .price{
      font-size:1.1rem;
      font-weight:800;
      margin-top:2px;
    }
    .price-usd{ color:var(--usd); }
    .price-ars{ color:var(--text); font-weight:750; }

    .installments{
      font-size:.9rem;
      color:#555;
      margin-top:4px;
    }

    button{
      margin-top:14px;
      padding:12px 14px;
      border:none;
      border-radius:14px;
      background:var(--primary);
      color:#fff;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 14px 26px rgba(0,113,227,.20);
      transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
    }
    button:hover{
      transform: translateY(-1px);
      box-shadow: 0 18px 34px rgba(0,113,227,.24);
      opacity:.98;
    }

    .close{
      background:#e5e5ea;
      color:#111;
      box-shadow:none;
    }
    .close:hover{ box-shadow:none; }

    /* Coloreo de palabras en details */
    .color-word{ font-weight:800; }
    .cw-azul{ color:#2563eb; }
    .cw-celeste{ color:#0ea5e9; }
    .cw-rojo{ color:#ef4444; }
    .cw-negro{ color:#111827; }
    .cw-blanco{ color:#64748b; }
    .cw-dorado{ color:#b45309; }
    .cw-gris{ color:#6b7280; }
    .cw-plata{ color:#94a3b8; }
    .cw-verde{ color:#16a34a; }
    .cw-morado{ color:#7c3aed; }

    /* modal */
    .modal{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index:9999;
    }
    .modal-content{
      background:#fff;
      border-radius:18px;
      padding:20px;
      max-width:540px;
      width:100%;
      box-shadow: 0 30px 90px rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.25);
    }
    .modal-content h2{
      margin:0 0 12px;
      letter-spacing:-.2px;
    }

    .result{
      background:#f6f7fb;
      padding:14px;
      border-radius:14px;
      margin-top:10px;
      border:1px solid rgba(0,0,0,.06);
      min-height: 52px;
    }

    /* ‚úÖ acciones del modal */
    .modal-actions{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:12px;
      align-items:center;
      justify-content:flex-start; /* evita estiramientos raros */
    }

    /* ‚úÖ Bot√≥n WhatsApp m√°s chico + icono centrado */
    .wa-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;

      height:44px;                 /* m√°s compacto */
      padding:0 16px;              /* sin padding vertical */
      border-radius:14px;

      text-decoration:none;
      font-weight:800;
      font-size:.95rem;            /* m√°s chico */
      line-height:44px;            /* ayuda a centrar texto */

      color:white;
      background: var(--wa);
      box-shadow: 0 10px 22px rgba(37,211,102,.20);
      transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;

      flex: 0 0 auto;              /* NO ocupa toda la fila */
      min-width: 190px;            /* tama√±o consistente */
    }
    .wa-btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 14px 28px rgba(37,211,102,.26);
      opacity:.98;
    }
    .wa-icon{
      width:18px;
      height:18px;
      display:block;               /* evita descentrado */
      flex: 0 0 18px;              /* reserva espacio fijo */
      margin:0;
      transform: translateY(0);    /* por si alg√∫n navegador aplica baseline raro */
      fill: white;
    }

    .warning{
      font-size:.85rem;
      color:#6b7280;
      margin-top:14px;
    }
  </style>
</head>

<body>
<header>
  Renov√° tu iPhone en Apple Trade con la mejor cotizaci√≥n.
</header>

<main>
  <div class="filters">
    <select id="filterLine">
      <option value="">Filtr√° por modelo</option>
      <option value="12">iPhone 12</option>
      <option value="13">iPhone 13</option>
      <option value="14">iPhone 14</option>
      <option value="15">iPhone 15</option>
      <option value="16">iPhone 16</option>
      <option value="17">iPhone 17</option>
    </select>

    <select id="filterCondition">
      <option value="">Nuevo o seminuevo</option>
      <option value="Seminuevo">Seminuevo</option>
      <option value="Nuevo">Nuevo</option>
    </select>

    <button type="button" id="clearFilters" class="close" style="margin-top:0">Limpiar filtros</button>
  </div>

  <div class="toolbar">
    <div id="resultsCount" class="results-count">0 equipos disponibles</div>

    <select id="sortPrice">
      <option value="">Ordenar por</option>
      <option value="asc">Precio: menor a mayor</option>
      <option value="desc">Precio: mayor a menor</option>
    </select>
  </div>

  <section class="products" id="productList"></section>
</main>

<div class="modal" id="modal" aria-hidden="true">
  <div class="modal-content">
    <h2>Cotizaci√≥n de Canje</h2>

    <label>iPhone que entreg√°s</label>
    <select id="tradeInSelect"></select>

    <label>iPhone que quer√©s</label>
    <select id="buySelect"></select>

    <div class="result" id="result"></div>

    <div class="modal-actions">
      <a id="whatsappBtn" class="wa-btn" href="#" target="_blank" rel="noopener">
        <svg class="wa-icon" viewBox="0 0 32 32" aria-hidden="true" focusable="false">
          <path d="M19.11 17.53c-.3-.15-1.77-.87-2.05-.97-.28-.1-.48-.15-.68.15-.2.3-.78.97-.95 1.17-.17.2-.35.22-.65.07-.3-.15-1.25-.46-2.38-1.47-.88-.78-1.47-1.74-1.64-2.04-.17-.3-.02-.46.13-.61.13-.13.3-.35.45-.52.15-.17.2-.3.3-.5.1-.2.05-.37-.02-.52-.07-.15-.68-1.64-.93-2.25-.24-.58-.48-.5-.68-.5h-.58c-.2 0-.52.07-.8.37-.28.3-1.05 1.02-1.05 2.5s1.08 2.9 1.23 3.1c.15.2 2.13 3.25 5.15 4.55.72.31 1.28.49 1.72.62.72.23 1.38.2 1.9.12.58-.09 1.77-.72 2.02-1.42.25-.7.25-1.3.17-1.42-.07-.12-.27-.2-.57-.35z"/>
          <path d="M26.7 5.3A14.9 14.9 0 0 0 4.2 25.9L3 30l4.2-1.1A14.9 14.9 0 0 0 26.7 5.3zM16 28.1c-2.4 0-4.7-.6-6.8-1.8l-.49-.29-2.49.65.66-2.43-.32-.5A12.1 12.1 0 1 1 16 28.1zM16 6.2a9.8 9.8 0 0 0-8.4 14.8l.4.63-.4 1.5 1.55-.41.6.36A9.8 9.8 0 1 0 16 6.2z"/>
        </svg>
        Canjear Ahora
      </a>

      <button class="close" onclick="closeModal()" style="margin-top:0; height:44px; padding:0 16px;">Cerrar</button>
    </div>

    <div class="warning">
      * La cotizaci√≥n es estimada y sujeta a revisi√≥n del equipo entregado.
    </div>
  </div>
</div>

<script>
  /* ======================
     CONFIGURACI√ìN MASIVA
  ======================= */
  let USD_TO_ARS = 1800;
  let INTEREST_3 = 1.55;
  let INTEREST_6 = 1.55;

  /* ‚úÖ PON√â TU N√öMERO (sin +, sin espacios)
     Ej: 54911XXXXXXXX
  */
  const WHATSAPP_NUMBER = "54911XXXXXXXX";

  function calculatePrices(priceUSD) {
    const priceARS = priceUSD * USD_TO_ARS;
    return {
      usd: priceUSD,
      ars: priceARS,
      cuotas3: (priceARS * INTEREST_3) / 3,
      cuotas6: (priceARS * INTEREST_6) / 6
    };
  }

  /* ======================
     STOCK
  ======================= */
  const products = [
    { model: "iPhone 12 Pro", storage: "128GB", condition: "Seminuevo", details: "Azul ¬∑ Bater√≠a 100%", priceUSD: 350 },
    { model: "iPhone 12 Pro Max", storage: "128GB", condition: "Seminuevo", details: "Blanco ¬∑ Bater√≠a 88%", priceUSD: 365 },
    { model: "iPhone 13 Pro", storage: "128GB", condition: "Seminuevo", details: "Celeste ¬∑ Bater√≠a 100%", priceUSD: 495 },
    { model: "iPhone 14 Plus", storage: "128GB", condition: "Seminuevo", details: "Rojo ¬∑ Bater√≠a 85‚Äì86%", priceUSD: 425 },
    { model: "iPhone 14 Plus", storage: "128GB", condition: "Seminuevo", details: "Rojo ¬∑ Bater√≠a 100%", priceUSD: 450 },
    { model: "iPhone 14 Pro", storage: "256GB", condition: "Seminuevo", details: "Negro ¬∑ Bater√≠a 100%", priceUSD: 600 },
    { model: "iPhone 14 Pro Max", storage: "128GB", condition: "Seminuevo", details: "Negro / Dorado ¬∑ Bater√≠a 100%", priceUSD: 625 },
    { model: "iPhone 15", storage: "128GB", condition: "Seminuevo", details: "Celeste ¬∑ Bater√≠a 85%", priceUSD: 495 },
    { model: "iPhone 15", storage: "128GB", condition: "Seminuevo", details: "Negro ¬∑ Bater√≠a 90%", priceUSD: 505 },
    { model: "iPhone 15 Pro", storage: "128GB", condition: "Seminuevo", details: "Azul ¬∑ Bater√≠a 95%", priceUSD: 650 },
    { model: "iPhone 15 Pro Max", storage: "256GB", condition: "Seminuevo", details: "Azul ¬∑ Bater√≠a 88%", priceUSD: 735 },
    { model: "iPhone 15 Pro Max", storage: "256GB", condition: "Seminuevo", details: "Azul ¬∑ Bater√≠a 90‚Äì94%", priceUSD: 785 },
    { model: "iPhone 16 Pro", storage: "128GB", condition: "Seminuevo", details: "Blanco ¬∑ Caja original ¬∑ Bater√≠a 92%", priceUSD: 750 }
  ];

  const tradeInValues = {
    "iPhone 11": 300,
    "iPhone 11 Pro Max": 420,
    "iPhone 13": 550,
    "iPhone 14 Pro": 720
  };

  /* ======================
     COLORES: palabras + chips
  ======================= */
  const COLOR_MAP = {
    azul:   { wordClass: "cw-azul",   dot: "#2563eb" },
    celeste:{ wordClass: "cw-celeste",dot: "#0ea5e9" },
    rojo:   { wordClass: "cw-rojo",   dot: "#ef4444" },
    negro:  { wordClass: "cw-negro",  dot: "#111827" },
    blanco: { wordClass: "cw-blanco", dot: "#e5e7eb" },
    dorado: { wordClass: "cw-dorado", dot: "#d97706" },
    gris:   { wordClass: "cw-gris",   dot: "#6b7280" },
    plata:  { wordClass: "cw-plata",  dot: "#cbd5e1" },
    verde:  { wordClass: "cw-verde",  dot: "#16a34a" },
    morado: { wordClass: "cw-morado", dot: "#7c3aed" }
  };

  function colorizeDetails(details) {
    if (!details) return "";
    let out = details;
    Object.keys(COLOR_MAP).forEach(colorWord => {
      const cls = COLOR_MAP[colorWord].wordClass;
      const re = new RegExp(`\\b${colorWord}\\b`, "gi");
      out = out.replace(re, (match) => `<span class="color-word ${cls}">${match}</span>`);
    });
    return out;
  }

  function extractColors(details) {
    if (!details) return [];
    const lower = details.toLowerCase();
    const found = [];
    Object.keys(COLOR_MAP).forEach(c => { if (lower.includes(c)) found.push(c); });
    found.sort((a,b) => lower.indexOf(a) - lower.indexOf(b));
    return [...new Set(found)];
  }

  function renderColorChips(details) {
    const colors = extractColors(details);
    if (!colors.length) return "";
    return `
      <div class="color-chips">
        ${colors.map(c => `
          <span class="chip" title="Color ${c}">
            <span class="dot" style="background:${COLOR_MAP[c].dot}"></span>
            <span>${c.charAt(0).toUpperCase()+c.slice(1)}</span>
          </span>
        `).join("")}
      </div>
    `;
  }

  /* ======================
     DOM refs
  ======================= */
  const productList = document.getElementById("productList");
  const modal = document.getElementById("modal");
  const tradeInSelect = document.getElementById("tradeInSelect");
  const buySelect = document.getElementById("buySelect");
  const result = document.getElementById("result");
  const whatsappBtn = document.getElementById("whatsappBtn");

  const filterLineEl = document.getElementById("filterLine");
  const filterConditionEl = document.getElementById("filterCondition");
  const clearFiltersBtn = document.getElementById("clearFilters");
  const sortPriceEl = document.getElementById("sortPrice");
  const resultsCountEl = document.getElementById("resultsCount");

  let currentBuyProductIndex = null;
  let lastPricing = null;

  /* ======================
     RENDER
  ======================= */
  function renderProducts() {
    productList.innerHTML = "";

    const filterLine = filterLineEl?.value || "";
    const filterCondition = filterConditionEl?.value || "";
    const sortValue = sortPriceEl?.value || "";

    let filteredProducts = products.filter(p => {
      if (filterCondition && p.condition !== filterCondition) return false;
      if (filterLine && !p.model.includes(`iPhone ${filterLine}`)) return false;
      return true;
    });

    // ordenar
    if (sortValue === "asc") filteredProducts.sort((a,b) => a.priceUSD - b.priceUSD);
    if (sortValue === "desc") filteredProducts.sort((a,b) => b.priceUSD - a.priceUSD);

    if (resultsCountEl) resultsCountEl.textContent = `${filteredProducts.length} equipos disponibles`;

    filteredProducts.forEach(p => {
      const pricing = calculatePrices(p.priceUSD);

      const card = document.createElement("div");
      card.className = "product";

      card.innerHTML = `
        <div>
          <h3>${p.model} ${p.storage}</h3>
          <p class="condition-text">${p.condition}</p>

          ${renderColorChips(p.details)}
          <p class="details">${colorizeDetails(p.details || "")}</p>

          <div class="price price-usd">USD ${pricing.usd}</div>
          <div class="price price-ars">ARS ${pricing.ars.toLocaleString()}</div>

          <div class="installments">3 cuotas: ARS ${pricing.cuotas3.toLocaleString()}</div>
          <div class="installments">6 cuotas: ARS ${pricing.cuotas6.toLocaleString()}</div>
        </div>

        <button onclick="openModal(${products.indexOf(p)})">Cotizar canje</button>
      `;

      productList.appendChild(card);
    });
  }

  /* ======================
     MODAL
  ======================= */
  function openModal(productIndex) {
    const selectedProduct = products[productIndex];
    if (!selectedProduct) return;

    currentBuyProductIndex = productIndex;
    lastPricing = null;

    modal.style.display = "flex";
    modal.setAttribute("aria-hidden", "false");
    result.innerHTML = "";

    tradeInSelect.innerHTML = `<option value="">Seleccion√° tu iPhone</option>`;
    buySelect.innerHTML = "";

    Object.keys(tradeInValues).forEach(model => {
      tradeInSelect.innerHTML += `<option value="${model}">${model}</option>`;
    });

    buySelect.innerHTML = `
      <option value="${selectedProduct.priceUSD}">
        ${selectedProduct.model} ${selectedProduct.storage}
      </option>
    `;

    updateWhatsAppLink();
  }

  function closeModal() {
    modal.style.display = "none";
    modal.setAttribute("aria-hidden", "true");
    tradeInSelect.value = "";
    result.innerHTML = "";
    currentBuyProductIndex = null;
    lastPricing = null;
  }

  modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
  tradeInSelect.addEventListener("change", calculate);

  function calculate() {
    const tradeModel = tradeInSelect.value;
    if (!tradeModel) {
      result.innerHTML = "";
      lastPricing = null;
      updateWhatsAppLink();
      return;
    }

    const tradeValueUSD = tradeInValues[tradeModel];
    const buyPriceUSD = Number(buySelect.value);

    const diffUSD = buyPriceUSD - tradeValueUSD;
    const pricing = calculatePrices(diffUSD);

    lastPricing = { tradeModel, tradeValueUSD, buyPriceUSD, diffUSD, pricing };

    result.innerHTML = `
      <strong>Diferencia a pagar:</strong><br><br>
      <span style="color:var(--usd); font-weight:900;">USD ${pricing.usd}</span><br>
      ARS ${pricing.ars.toLocaleString()}<br><br>
      3 cuotas: ARS ${pricing.cuotas3.toLocaleString()}<br>
      6 cuotas: ARS ${pricing.cuotas6.toLocaleString()}
    `;

    updateWhatsAppLink();
  }

  /* ======================
     WHATSAPP
  ======================= */
  function updateWhatsAppLink() {
    if (!WHATSAPP_NUMBER || WHATSAPP_NUMBER.includes("X")) {
      whatsappBtn.href = "#";
      whatsappBtn.style.opacity = "0.6";
      whatsappBtn.style.pointerEvents = "none";
      whatsappBtn.title = "Configur√° WHATSAPP_NUMBER en el c√≥digo";
      return;
    }

    if (!lastPricing || currentBuyProductIndex === null) {
      whatsappBtn.href = "#";
      whatsappBtn.style.opacity = "0.7";
      whatsappBtn.style.pointerEvents = "none";
      whatsappBtn.title = "Seleccion√° tu iPhone para calcular la diferencia";
      return;
    }

    const buy = products[currentBuyProductIndex];
    const msg =
`Hola! Quiero canjear mi iPhone.

üì≤ Entrego: ${lastPricing.tradeModel} (valor estimado USD ${lastPricing.tradeValueUSD})
‚úÖ Quiero: ${buy.model} ${buy.storage} (${buy.details})

üí∞ Diferencia estimada:
- USD ${lastPricing.pricing.usd}
- ARS ${lastPricing.pricing.ars.toLocaleString()}
- 3 cuotas: ARS ${lastPricing.pricing.cuotas3.toLocaleString()}
- 6 cuotas: ARS ${lastPricing.pricing.cuotas6.toLocaleString()}

¬øMe ayud√°s a avanzar con el canje?`;

    const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`;
    whatsappBtn.href = url;
    whatsappBtn.style.opacity = "1";
    whatsappBtn.style.pointerEvents = "auto";
    whatsappBtn.title = "Abrir WhatsApp";
  }

  /* ======================
     FILTROS / ORDEN
  ======================= */
  filterLineEl.addEventListener("change", renderProducts);
  filterConditionEl.addEventListener("change", renderProducts);
  sortPriceEl.addEventListener("change", renderProducts);

  clearFiltersBtn.addEventListener("click", () => {
    filterLineEl.value = "";
    filterConditionEl.value = "";
    sortPriceEl.value = "";
    renderProducts();
  });

  document.addEventListener("DOMContentLoaded", () => {
    filterLineEl.value = "";
    filterConditionEl.value = "";
    sortPriceEl.value = "";
    renderProducts();
  });
</script>
</body>
</html>

