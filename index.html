<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cotizador de Canje iPhone</title>

  <style>
    :root{
      --primary:#0071e3;
      --bg:#f5f5f7;
      --text:#1d1d1f;
      --muted:#6e6e73;
      --border:rgba(0,0,0,.08);

      --usd:#16a34a;

      /* sombras premium */
      --shadow: 0 10px 26px rgba(0,0,0,.06);
      --shadow-hover: 0 16px 42px rgba(0,0,0,.10);

      /* badges */
      --badge-semi-bg: rgba(22,163,74,.12);
      --badge-semi-fg: #15803d;

      --badge-new-bg: rgba(0,113,227,.12);
      --badge-new-fg: #005bb5;
    }

    *{ box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; }
    body{ margin:0; background:var(--bg); color:var(--text); }

    header{
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
      padding:18px 20px;
      text-align:center;
      font-weight:650;
      font-size:1.35rem;
      position:sticky;
      top:0;
      z-index:50;
    }

    main{ padding:20px; max-width:1200px; margin:auto; }

    /* filtros */
    .filters{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-bottom:18px;
    }
    select{
      width:min(420px,100%);
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      outline:none;
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
      transition: box-shadow .2s ease, border-color .2s ease;
    }
    select:focus{
      border-color: rgba(0,113,227,.35);
      box-shadow: 0 0 0 4px rgba(0,113,227,.15);
    }

    .products{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
      gap:18px;
    }

    .product{
      background:#fff;
      border:1px solid var(--border);
      border-radius:18px;
      padding:18px;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }
    .product:hover{
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
      border-color: rgba(0,0,0,.12);
    }

    .top-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
    }

    .product h3{
      margin:0;
      font-size:1.05rem;
      letter-spacing:-.2px;
      line-height:1.25rem;
    }

    .badges{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .badge{
      font-size:.78rem;
      font-weight:750;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.06);
      white-space:nowrap;
    }
    .badge.semi{ background:var(--badge-semi-bg); color:var(--badge-semi-fg); }
    .badge.new{ background:var(--badge-new-bg); color:var(--badge-new-fg); }

    .details{
      margin:8px 0 10px;
      font-size:.92rem;
      color:#515154;
      line-height:1.25rem;
    }

    /* chips de color (bolita + texto) */
    .color-chips{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin:6px 0 10px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(245,245,247,.7);
      font-size:.82rem;
      color:#2b2b2f;
      font-weight:650;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      border:1px solid rgba(0,0,0,.15);
      box-shadow: 0 1px 2px rgba(0,0,0,.10) inset;
    }

    /* USD verde */
    .price{
      font-size:1.1rem;
      font-weight:800;
      margin-top:2px;
    }
    .price-usd{ color:var(--usd); }
    .price-ars{ color:var(--text); font-weight:750; }

    .installments{
      font-size:.9rem;
      color:#555;
      margin-top:4px;
    }

    button{
      margin-top:14px;
      padding:12px 14px;
      border:none;
      border-radius:14px;
      background:var(--primary);
      color:#fff;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 14px 26px rgba(0,113,227,.20);
      transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
    }
    button:hover{
      transform: translateY(-1px);
      box-shadow: 0 18px 34px rgba(0,113,227,.24);
      opacity:.98;
    }

    .close{
      background:#e5e5ea;
      color:#111;
      box-shadow:none;
    }
    .close:hover{ box-shadow:none; }

    /* Coloreo de palabras en details */
    .color-word{ font-weight:800; }
    .cw-azul{ color:#2563eb; }
    .cw-celeste{ color:#0ea5e9; }
    .cw-rojo{ color:#ef4444; }
    .cw-negro{ color:#111827; }
    .cw-blanco{ color:#64748b; } /* visible sobre blanco */
    .cw-dorado{ color:#b45309; }
    .cw-gris{ color:#6b7280; }
    .cw-plata{ color:#94a3b8; }
    .cw-verde{ color:#16a34a; }
    .cw-morado{ color:#7c3aed; }

    /* modal */
    .modal{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index:9999;
    }
    .modal-content{
      background:#fff;
      border-radius:18px;
      padding:20px;
      max-width:540px;
      width:100%;
      box-shadow: 0 30px 90px rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.25);
    }
    .modal-content h2{
      margin:0 0 12px;
      letter-spacing:-.2px;
    }

    .result{
      background:#f6f7fb;
      padding:14px;
      border-radius:14px;
      margin-top:10px;
      border:1px solid rgba(0,0,0,.06);
    }
    .warning{
      font-size:.85rem;
      color:#6b7280;
      margin-top:14px;
    }
  </style>
</head>

<body>
<header>Cotizá tu canje de iPhone</header>

<main>
  <div class="filters">
    <select id="filterLine">
      <option value="">Filtrá por modelo</option>
      <option value="12">iPhone 12</option>
      <option value="13">iPhone 13</option>
      <option value="14">iPhone 14</option>
      <option value="15">iPhone 15</option>
      <option value="16">iPhone 16</option>
      <option value="17">iPhone 17</option>
    </select>

    <select id="filterCondition">
      <option value="">Nuevo o usado?s</option>
      <option value="Seminuevo">Seminuevo</option>
      <option value="Nuevo">Nuevo</option>
    </select>

    <button type="button" id="clearFilters" class="close" style="margin-top:0">Limpiar filtros</button>
  </div>

  <section class="products" id="productList"></section>
</main>

<div class="modal" id="modal" aria-hidden="true">
  <div class="modal-content">
    <h2>Cotización de Canje</h2>

    <label>iPhone que entregás</label>
    <select id="tradeInSelect"></select>

    <label>iPhone que querés</label>
    <select id="buySelect"></select>

    <div class="result" id="result"></div>

    <button class="close" onclick="closeModal()">Cerrar</button>

    <div class="warning">
      * La cotización es estimada y sujeta a revisión del equipo entregado.
    </div>
  </div>
</div>

<script>
  /* ======================
     CONFIGURACIÓN MASIVA
  ======================= */
  let USD_TO_ARS = 1800;
  let INTEREST_3 = 1.55;
  let INTEREST_6 = 1.55;

  function calculatePrices(priceUSD) {
    const priceARS = priceUSD * USD_TO_ARS;
    return {
      usd: priceUSD,
      ars: priceARS,
      cuotas3: (priceARS * INTEREST_3) / 3,
      cuotas6: (priceARS * INTEREST_6) / 6
    };
  }

  /* ======================
     STOCK
  ======================= */
  const products = [
    { model: "iPhone 12 Pro", storage: "128GB", condition: "Seminuevo", details: "Azul · Batería 100%", priceUSD: 350 },
    { model: "iPhone 12 Pro Max", storage: "128GB", condition: "Seminuevo", details: "Blanco · Batería 88%", priceUSD: 365 },
    { model: "iPhone 13 Pro", storage: "128GB", condition: "Seminuevo", details: "Celeste · Batería 100%", priceUSD: 495 },
    { model: "iPhone 14 Plus", storage: "128GB", condition: "Seminuevo", details: "Rojo · Batería 85–86%", priceUSD: 425 },
    { model: "iPhone 14 Plus", storage: "128GB", condition: "Seminuevo", details: "Rojo · Batería 100%", priceUSD: 450 },
    { model: "iPhone 14 Pro", storage: "256GB", condition: "Seminuevo", details: "Negro · Batería 100%", priceUSD: 600 },
    { model: "iPhone 14 Pro Max", storage: "128GB", condition: "Seminuevo", details: "Negro / Dorado · Batería 100%", priceUSD: 625 },
    { model: "iPhone 15", storage: "128GB", condition: "Seminuevo", details: "Celeste · Batería 85%", priceUSD: 495 },
    { model: "iPhone 15", storage: "128GB", condition: "Seminuevo", details: "Negro · Batería 90%", priceUSD: 505 },
    { model: "iPhone 15 Pro", storage: "128GB", condition: "Seminuevo", details: "Azul · Batería 95%", priceUSD: 650 },
    { model: "iPhone 15 Pro Max", storage: "256GB", condition: "Seminuevo", details: "Azul · Batería 88%", priceUSD: 735 },
    { model: "iPhone 15 Pro Max", storage: "256GB", condition: "Seminuevo", details: "Azul · Batería 90–94%", priceUSD: 785 },
    { model: "iPhone 16 Pro", storage: "128GB", condition: "Seminuevo", details: "Blanco · Caja original · Batería 92%", priceUSD: 750 }
  ];

  const tradeInValues = {
    "iPhone 11": 300,
    "iPhone 11 Pro Max": 420,
    "iPhone 13": 550,
    "iPhone 14 Pro": 720
  };

  /* ======================
     COLORES: palabras + chips
  ======================= */

  // color -> clase palabra (cw-*) y color -> color del dot
  const COLOR_MAP = {
    azul:   { wordClass: "cw-azul",   dot: "#2563eb" },
    celeste:{ wordClass: "cw-celeste",dot: "#0ea5e9" },
    rojo:   { wordClass: "cw-rojo",   dot: "#ef4444" },
    negro:  { wordClass: "cw-negro",  dot: "#111827" },
    blanco: { wordClass: "cw-blanco", dot: "#e5e7eb" },
    dorado: { wordClass: "cw-dorado", dot: "#d97706" },
    gris:   { wordClass: "cw-gris",   dot: "#6b7280" },
    plata:  { wordClass: "cw-plata",  dot: "#cbd5e1" },
    verde:  { wordClass: "cw-verde",  dot: "#16a34a" },
    morado: { wordClass: "cw-morado", dot: "#7c3aed" }
  };

  // Envuelve palabras de color dentro del string con spans coloreados
  function colorizeDetails(details) {
    if (!details) return "";
    let out = details;

    Object.keys(COLOR_MAP).forEach(colorWord => {
      const cls = COLOR_MAP[colorWord].wordClass;
      const re = new RegExp(`\\b${colorWord}\\b`, "gi");
      out = out.replace(re, (match) => `<span class="color-word ${cls}">${match}</span>`);
    });

    return out;
  }

  // Extrae colores presentes en details (devuelve array único en orden de aparición)
  function extractColors(details) {
    if (!details) return [];
    const lower = details.toLowerCase();

    // buscamos en orden de aparición real recorriendo tokens
    // (simple y robusto para "Negro / Dorado · ...")
    const found = [];
    Object.keys(COLOR_MAP).forEach(c => {
      if (lower.includes(c)) found.push(c);
    });

    // ordenar según primera posición encontrada
    found.sort((a,b) => lower.indexOf(a) - lower.indexOf(b));

    // unique
    return [...new Set(found)];
  }

  function renderColorChips(details) {
    const colors = extractColors(details);
    if (!colors.length) return "";

    return `
      <div class="color-chips">
        ${colors.map(c => `
          <span class="chip" title="Color ${c}">
            <span class="dot" style="background:${COLOR_MAP[c].dot}"></span>
            <span>${c.charAt(0).toUpperCase()+c.slice(1)}</span>
          </span>
        `).join("")}
      </div>
    `;
  }

  /* ======================
     DOM refs
  ======================= */
  const productList = document.getElementById("productList");
  const modal = document.getElementById("modal");
  const tradeInSelect = document.getElementById("tradeInSelect");
  const buySelect = document.getElementById("buySelect");
  const result = document.getElementById("result");

  const filterLineEl = document.getElementById("filterLine");
  const filterConditionEl = document.getElementById("filterCondition");
  const clearFiltersBtn = document.getElementById("clearFilters");

  /* ======================
     RENDER
  ======================= */
  function conditionBadge(condition){
    const c = (condition || "").toLowerCase();
    if (c.includes("nuevo")) return `<span class="badge new">Nuevo</span>`;
    return `<span class="badge semi">Seminuevo</span>`;
  }

  function renderProducts() {
    productList.innerHTML = "";

    const filterLine = filterLineEl?.value || "";
    const filterCondition = filterConditionEl?.value || "";

    const filteredProducts = products.filter(p => {
      if (filterCondition && p.condition !== filterCondition) return false;
      if (filterLine && !p.model.includes(`iPhone ${filterLine}`)) return false;
      return true;
    });

    filteredProducts.forEach(p => {
      const pricing = calculatePrices(p.priceUSD);

      const card = document.createElement("div");
      card.className = "product";

      card.innerHTML = `
        <div>
          <div class="top-row">
            <h3>${p.model} ${p.storage}</h3>
            <div class="badges">
              ${conditionBadge(p.condition)}
            </div>
          </div>

          ${renderColorChips(p.details)}

          <p class="details">${colorizeDetails(p.details || "")}</p>

          <div class="price price-usd">USD ${pricing.usd}</div>
          <div class="price price-ars">ARS ${pricing.ars.toLocaleString()}</div>

          <div class="installments">3 cuotas: ARS ${pricing.cuotas3.toLocaleString()}</div>
          <div class="installments">6 cuotas: ARS ${pricing.cuotas6.toLocaleString()}</div>
        </div>

        <button onclick="openModal(${products.indexOf(p)})">Cotizar canje</button>
      `;

      productList.appendChild(card);
    });
  }

  /* ======================
     MODAL
  ======================= */
  function openModal(productIndex) {
    const selectedProduct = products[productIndex];
    if (!selectedProduct) return;

    modal.style.display = "flex";
    modal.setAttribute("aria-hidden", "false");
    result.innerHTML = "";

    tradeInSelect.innerHTML = `<option value="">Seleccioná tu iPhone</option>`;
    buySelect.innerHTML = "";

    Object.keys(tradeInValues).forEach(model => {
      tradeInSelect.innerHTML += `<option value="${model}">${model}</option>`;
    });

    buySelect.innerHTML = `
      <option value="${selectedProduct.priceUSD}">
        ${selectedProduct.model} ${selectedProduct.storage}
      </option>
    `;
  }

  function closeModal() {
    modal.style.display = "none";
    modal.setAttribute("aria-hidden", "true");
    tradeInSelect.value = "";
    result.innerHTML = "";
  }

  modal.addEventListener("click", (e) => {
    if (e.target === modal) closeModal();
  });

  tradeInSelect.addEventListener("change", calculate);

  function calculate() {
    const tradeModel = tradeInSelect.value;
    if (!tradeModel) { result.innerHTML = ""; return; }

    const tradeValueUSD = tradeInValues[tradeModel];
    const buyPriceUSD = Number(buySelect.value);

    const diffUSD = buyPriceUSD - tradeValueUSD;
    const pricing = calculatePrices(diffUSD);

    result.innerHTML = `
      <strong>Diferencia a pagar:</strong><br><br>
      <span style="color:var(--usd); font-weight:900;">USD ${pricing.usd}</span><br>
      ARS ${pricing.ars.toLocaleString()}<br><br>
      3 cuotas: ARS ${pricing.cuotas3.toLocaleString()}<br>
      6 cuotas: ARS ${pricing.cuotas6.toLocaleString()}
    `;
  }

  /* ======================
     FILTROS
  ======================= */
  filterLineEl.addEventListener("change", renderProducts);
  filterConditionEl.addEventListener("change", renderProducts);

  clearFiltersBtn.addEventListener("click", () => {
    filterLineEl.value = "";
    filterConditionEl.value = "";
    renderProducts();
  });

  document.addEventListener("DOMContentLoaded", () => {
    filterLineEl.value = "";
    filterConditionEl.value = "";
    renderProducts();
  });
</script>
</body>
</html>
