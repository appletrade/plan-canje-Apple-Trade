<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cotizador de Canje iPhone</title>

  <style>
    :root {
      --primary: #0071e3;
      --gray: #f5f5f7;
      --text: #1d1d1f;

      /* nuevos */
      --muted: #6e6e73;
      --card-shadow: 0 10px 30px rgba(0,0,0,0.06);
      --card-shadow-hover: 0 14px 38px rgba(0,0,0,0.10);
      --border: rgba(0,0,0,0.08);
      --usd-green: #16a34a; /* verde elegante */
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    body {
      margin: 0;
      background: var(--gray);
      color: var(--text);
    }

    header {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 20px;
      text-align: center;
      font-weight: 650;
      font-size: 1.35rem;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    main {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }

    /* contenedor filtros */
    .filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 18px;
      align-items: center;
    }

    select {
      width: min(420px, 100%);
      padding: 12px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      outline: none;
      color: var(--text);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: box-shadow .2s ease, transform .2s ease, border-color .2s ease;
    }
    select:focus {
      border-color: rgba(0,113,227,0.35);
      box-shadow: 0 0 0 4px rgba(0,113,227,0.15);
    }

    .products {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 18px;
    }

    .product {
      background: white;
      border-radius: 16px;
      padding: 18px 18px 16px;
      box-shadow: var(--card-shadow);
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    }

    .product:hover {
      transform: translateY(-3px);
      box-shadow: var(--card-shadow-hover);
      border-color: rgba(0,0,0,0.12);
    }

    .product h3 {
      margin: 0 0 8px;
      font-size: 1.05rem;
      letter-spacing: -0.2px;
    }

    .meta {
      color: var(--muted);
      margin: 0 0 8px;
      font-size: 0.95rem;
    }

    .details {
      margin: 0 0 10px;
      font-size: 0.92rem;
      color: #515154;
      line-height: 1.25rem;
    }

    .price {
      font-size: 1.1rem;
      font-weight: 750;
      margin-top: 2px;
    }

    /* USD en verde */
    .price-usd {
      color: var(--usd-green);
      font-weight: 800;
    }

    .price-ars {
      color: var(--text);
      font-weight: 750;
    }

    .installments {
      font-size: 0.9rem;
      color: #555;
      margin-top: 4px;
    }

    button {
      margin-top: 14px;
      padding: 12px 14px;
      border: none;
      border-radius: 12px;
      background: var(--primary);
      color: white;
      font-size: 1rem;
      font-weight: 650;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(0,113,227,0.18);
      transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 26px rgba(0,113,227,0.22);
      opacity: 0.98;
    }

    .close {
      background: #e5e5ea;
      color: #111;
      box-shadow: none;
    }
    .close:hover {
      box-shadow: none;
      transform: translateY(-1px);
    }

    /* ======================
       COLOR CHIPS (palabras coloreadas)
    ======================= */
    .color-chip {
      font-weight: 750;
    }
    .color-azul { color: #2563eb; }
    .color-celeste { color: #0ea5e9; }
    .color-rojo { color: #ef4444; }
    .color-negro { color: #111827; }
    .color-blanco { color: #64748b; }  /* blanco visible sobre fondo blanco */
    .color-dorado { color: #b45309; }
    .color-gris { color: #6b7280; }
    .color-plata { color: #94a3b8; }
    .color-verde { color: #16a34a; }
    .color-morado { color: #7c3aed; }

    /* ======================
       MODAL
    ======================= */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 9999;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 20px;
      max-width: 520px;
      width: 100%;
      box-shadow: 0 30px 80px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.25);
    }

    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 12px;
      letter-spacing: -0.2px;
    }

    .result {
      background: #f6f7fb;
      padding: 14px;
      border-radius: 12px;
      margin-top: 10px;
      border: 1px solid rgba(0,0,0,0.06);
    }

    .warning {
      font-size: 0.85rem;
      color: #6b7280;
      margin-top: 14px;
    }
  </style>
</head>

<body>

<header>
  Cotizá tu canje de iPhone
</header>

<main>

  <div class="filters">
    <select id="filterLine">
      <option value="">Filtrá por modelo</option>
      <option value="12">iPhone 12</option>
      <option value="13">iPhone 13</option>
      <option value="14">iPhone 14</option>
      <option value="15">iPhone 15</option>
      <option value="16">iPhone 16</option>
      <option value="17">iPhone 17</option>
    </select>

    <select id="filterCondition">
      <option value="">Nuevo o usado?s</option>
      <option value="Seminuevo">Seminuevo</option>
      <option value="Nuevo">Nuevo</option>
    </select>

    <button type="button" id="clearFilters" class="close" style="margin-top:0">
      Limpiar filtros
    </button>
  </div>

  <section class="products" id="productList"></section>
</main>

<div class="modal" id="modal" aria-hidden="true">
  <div class="modal-content">
    <h2>Cotización de Canje</h2>

    <label>iPhone que entregás</label>
    <select id="tradeInSelect"></select>

    <label>iPhone que querés</label>
    <select id="buySelect"></select>

    <div class="result" id="result"></div>

    <button class="close" onclick="closeModal()">Cerrar</button>

    <div class="warning">
      * La cotización es estimada y sujeta a revisión del equipo entregado.
    </div>
  </div>
</div>

<script>
  /* ======================
     CONFIGURACIÓN MASIVA
  ======================= */
  let USD_TO_ARS = 1800;

  let INTEREST_3 = 1.55;
  let INTEREST_6 = 1.55;

  function calculatePrices(priceUSD) {
    const priceARS = priceUSD * USD_TO_ARS;
    return {
      usd: priceUSD,
      ars: priceARS,
      cuotas3: (priceARS * INTEREST_3) / 3,
      cuotas6: (priceARS * INTEREST_6) / 6
    };
  }

  /* ======================
     STOCK
  ======================= */
  const products = [
    { model: "iPhone 12 Pro", storage: "128GB", condition: "Seminuevo", details: "Azul · Batería 100%", priceUSD: 350 },
    { model: "iPhone 12 Pro Max", storage: "128GB", condition: "Seminuevo", details: "Blanco · Batería 88%", priceUSD: 365 },
    { model: "iPhone 13 Pro", storage: "128GB", condition: "Seminuevo", details: "Celeste · Batería 100%", priceUSD: 495 },
    { model: "iPhone 14 Plus", storage: "128GB", condition: "Seminuevo", details: "Rojo · Batería 85–86%", priceUSD: 425 },
    { model: "iPhone 14 Plus", storage: "128GB", condition: "Seminuevo", details: "Rojo · Batería 100%", priceUSD: 450 },
    { model: "iPhone 14 Pro", storage: "256GB", condition: "Seminuevo", details: "Negro · Batería 100%", priceUSD: 600 },
    { model: "iPhone 14 Pro Max", storage: "128GB", condition: "Seminuevo", details: "Negro / Dorado · Batería 100%", priceUSD: 625 },
    { model: "iPhone 15", storage: "128GB", condition: "Seminuevo", details: "Celeste · Batería 85%", priceUSD: 495 },
    { model: "iPhone 15", storage: "128GB", condition: "Seminuevo", details: "Negro · Batería 90%", priceUSD: 505 },
    { model: "iPhone 15 Pro", storage: "128GB", condition: "Seminuevo", details: "Azul · Batería 95%", priceUSD: 650 },
    { model: "iPhone 15 Pro Max", storage: "256GB", condition: "Seminuevo", details: "Azul · Batería 88%", priceUSD: 735 },
    { model: "iPhone 15 Pro Max", storage: "256GB", condition: "Seminuevo", details: "Azul · Batería 90–94%", priceUSD: 785 },
    { model: "iPhone 16 Pro", storage: "128GB", condition: "Seminuevo", details: "Blanco · Caja original · Batería 92%", priceUSD: 750 }
  ];

  const tradeInValues = {
    "iPhone 11": 300,
    "iPhone 11 Pro Max": 420,
    "iPhone 13": 550,
    "iPhone 14 Pro": 720
  };

  /* ======================
     HELPERS: colorear texto de colores
  ======================= */

  // Mapeo de palabras de color -> clase CSS
  const COLOR_CLASS_MAP = {
    "azul": "color-azul",
    "celeste": "color-celeste",
    "rojo": "color-rojo",
    "negro": "color-negro",
    "blanco": "color-blanco",
    "dorado": "color-dorado",
    "gris": "color-gris",
    "plata": "color-plata",
    "verde": "color-verde",
    "morado": "color-morado"
  };

  // Envuelve palabras de color dentro del string con spans coloreados
  function colorizeDetails(details) {
    if (!details) return "";

    let out = details;

    // Reemplazo "palabra" por span. Se hace por palabras completas, case-insensitive.
    Object.keys(COLOR_CLASS_MAP).forEach(colorWord => {
      const cls = COLOR_CLASS_MAP[colorWord];
      const re = new RegExp(`\\b${colorWord}\\b`, "gi");
      out = out.replace(re, (match) => `<span class="color-chip ${cls}">${match}</span>`);
    });

    return out;
  }

  /* ======================
     DOM refs
  ======================= */
  const productList = document.getElementById("productList");
  const modal = document.getElementById("modal");
  const tradeInSelect = document.getElementById("tradeInSelect");
  const buySelect = document.getElementById("buySelect");
  const result = document.getElementById("result");

  const filterLineEl = document.getElementById("filterLine");
  const filterConditionEl = document.getElementById("filterCondition");
  const clearFiltersBtn = document.getElementById("clearFilters");

  /* ======================
     RENDER PRODUCTOS
  ======================= */
  function renderProducts() {
    productList.innerHTML = "";

    const filterLine = filterLineEl?.value || "";
    const filterCondition = filterConditionEl?.value || "";

    const filteredProducts = products.filter(p => {
      if (filterCondition && p.condition !== filterCondition) return false;
      if (filterLine && !p.model.includes(`iPhone ${filterLine}`)) return false;
      return true;
    });

    filteredProducts.forEach(p => {
      const pricing = calculatePrices(p.priceUSD);

      const card = document.createElement("div");
      card.className = "product";

      card.innerHTML = `
        <h3>${p.model} ${p.storage}</h3>
        <p class="meta">${p.condition}</p>

        <p class="details">${colorizeDetails(p.details)}</p>

        <div class="price price-usd">USD ${pricing.usd}</div>
        <div class="price price-ars">ARS ${pricing.ars.toLocaleString()}</div>

        <div class="installments">
          3 cuotas: ARS ${pricing.cuotas3.toLocaleString()}
        </div>
        <div class="installments">
          6 cuotas: ARS ${pricing.cuotas6.toLocaleString()}
        </div>

        <button onclick="openModal(${products.indexOf(p)})">Cotizar canje</button>
      `;

      productList.appendChild(card);
    });
  }

  /* ======================
     MODAL
  ======================= */
  function openModal(productIndex) {
    const selectedProduct = products[productIndex];
    if (!selectedProduct) return;

    modal.style.display = "flex";
    modal.setAttribute("aria-hidden", "false");
    result.innerHTML = "";

    tradeInSelect.innerHTML = `<option value="">Seleccioná tu iPhone</option>`;
    buySelect.innerHTML = "";

    Object.keys(tradeInValues).forEach(model => {
      tradeInSelect.innerHTML += `<option value="${model}">${model}</option>`;
    });

    buySelect.innerHTML = `
      <option value="${selectedProduct.priceUSD}">
        ${selectedProduct.model} ${selectedProduct.storage}
      </option>
    `;
  }

  function closeModal() {
    modal.style.display = "none";
    modal.setAttribute("aria-hidden", "true");
    tradeInSelect.value = "";
    result.innerHTML = "";
  }

  modal.addEventListener("click", (e) => {
    if (e.target === modal) closeModal();
  });

  tradeInSelect.addEventListener("change", calculate);

  function calculate() {
    const tradeModel = tradeInSelect.value;
    if (!tradeModel) {
      result.innerHTML = "";
      return;
    }

    const tradeValueUSD = tradeInValues[tradeModel];
    const buyPriceUSD = Number(buySelect.value);

    const diffUSD = buyPriceUSD - tradeValueUSD;
    const pricing = calculatePrices(diffUSD);

    result.innerHTML = `
      <strong>Diferencia a pagar:</strong><br><br>
      <span style="color: var(--usd-green); font-weight:800;">USD ${pricing.usd}</span><br>
      ARS ${pricing.ars.toLocaleString()}<br><br>
      3 cuotas: ARS ${pricing.cuotas3.toLocaleString()}<br>
      6 cuotas: ARS ${pricing.cuotas6.toLocaleString()}
    `;
  }

  /* ======================
     EVENTOS FILTROS
  ======================= */
  filterLineEl.addEventListener("change", renderProducts);
  filterConditionEl.addEventListener("change", renderProducts);

  clearFiltersBtn.addEventListener("click", () => {
    filterLineEl.value = "";
    filterConditionEl.value = "";
    renderProducts();
  });

  document.addEventListener("DOMContentLoaded", () => {
    if (filterLineEl) filterLineEl.value = "";
    if (filterConditionEl) filterConditionEl.value = "";
    renderProducts();
  });
</script>

</body>
</html>
